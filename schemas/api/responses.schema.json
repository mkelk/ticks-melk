{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://ticks.sh/schemas/api/responses.schema.json",
  "title": "API Responses",
  "description": "Response types for ticks API endpoints. Note: Computed fields use camelCase to match Go server JSON tags.",
  "$defs": {
    "TickColumn": {
      "type": "string",
      "enum": ["blocked", "ready", "agent", "human", "done"],
      "description": "Kanban column computed from tick state"
    },
    "VerificationStatus": {
      "type": "string",
      "enum": ["verified", "failed", "pending"],
      "description": "Verification status for completed tasks"
    },
    "Note": {
      "type": "object",
      "description": "Parsed note entry from tick.notes",
      "required": ["text"],
      "properties": {
        "timestamp": {
          "type": "string",
          "description": "Timestamp portion (YYYY-MM-DD HH:MM)"
        },
        "author": {
          "type": "string",
          "description": "Note author (human or agent)"
        },
        "text": {
          "type": "string",
          "description": "Note content"
        }
      }
    },
    "BlockerDetail": {
      "type": "object",
      "description": "Details about a blocking tick",
      "required": ["id", "title", "status"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Blocker tick ID"
        },
        "title": {
          "type": "string",
          "description": "Blocker tick title"
        },
        "status": {
          "type": "string",
          "description": "Blocker tick status"
        }
      }
    },
    "EpicInfo": {
      "type": "object",
      "description": "Summary info about an epic for dropdown lists",
      "required": ["id", "title"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Epic ID"
        },
        "title": {
          "type": "string",
          "description": "Epic title"
        }
      }
    },
    "TickResponse": {
      "type": "object",
      "description": "Tick with computed board fields (used in list responses)",
      "allOf": [
        { "$ref": "../tick.schema.json" },
        {
          "type": "object",
          "required": ["isBlocked", "column"],
          "properties": {
            "isBlocked": {
              "type": "boolean",
              "description": "Whether this tick is blocked by unresolved dependencies"
            },
            "column": {
              "$ref": "#/$defs/TickColumn",
              "description": "Computed kanban column"
            },
            "verificationStatus": {
              "$ref": "#/$defs/VerificationStatus",
              "description": "Verification status (for closed tasks only)"
            }
          }
        }
      ]
    },
    "GetTickResponse": {
      "type": "object",
      "description": "Detailed tick response with parsed notes and blocker details",
      "allOf": [
        { "$ref": "../tick.schema.json" },
        {
          "type": "object",
          "required": ["isBlocked", "column", "notesList", "blockerDetails"],
          "properties": {
            "isBlocked": {
              "type": "boolean",
              "description": "Whether this tick is blocked"
            },
            "column": {
              "$ref": "#/$defs/TickColumn",
              "description": "Computed kanban column"
            },
            "notesList": {
              "type": "array",
              "items": { "$ref": "#/$defs/Note" },
              "description": "Parsed notes from tick.notes"
            },
            "blockerDetails": {
              "type": "array",
              "items": { "$ref": "#/$defs/BlockerDetail" },
              "description": "Details about blocking ticks"
            }
          }
        }
      ]
    },
    "ListTicksResponse": {
      "type": "object",
      "description": "Response from GET /api/ticks",
      "required": ["ticks"],
      "properties": {
        "ticks": {
          "type": "array",
          "items": { "$ref": "#/$defs/TickResponse" },
          "description": "List of ticks matching the query"
        }
      }
    },
    "CreateTickResponse": {
      "type": "object",
      "description": "Response from POST /api/ticks",
      "allOf": [
        { "$ref": "../tick.schema.json" },
        {
          "type": "object",
          "required": ["isBlocked", "column"],
          "properties": {
            "isBlocked": {
              "type": "boolean",
              "description": "Whether this tick is blocked"
            },
            "column": {
              "$ref": "#/$defs/TickColumn",
              "description": "Computed kanban column"
            }
          }
        }
      ]
    },
    "ApproveTickResponse": {
      "type": "object",
      "description": "Response from POST /api/ticks/:id/approve",
      "allOf": [
        { "$ref": "../tick.schema.json" },
        {
          "type": "object",
          "required": ["isBlocked", "column", "closed"],
          "properties": {
            "isBlocked": {
              "type": "boolean",
              "description": "Whether this tick is blocked"
            },
            "column": {
              "$ref": "#/$defs/TickColumn",
              "description": "Computed kanban column"
            },
            "closed": {
              "type": "boolean",
              "description": "Whether the tick was closed as a result of approval"
            }
          }
        }
      ]
    },
    "RejectTickResponse": {
      "type": "object",
      "description": "Response from POST /api/ticks/:id/reject",
      "allOf": [
        { "$ref": "../tick.schema.json" },
        {
          "type": "object",
          "required": ["isBlocked", "column", "closed"],
          "properties": {
            "isBlocked": {
              "type": "boolean",
              "description": "Whether this tick is blocked"
            },
            "column": {
              "$ref": "#/$defs/TickColumn",
              "description": "Computed kanban column"
            },
            "closed": {
              "type": "boolean",
              "description": "Whether the tick was closed as a result of rejection"
            }
          }
        }
      ]
    },
    "CloseTickResponse": {
      "type": "object",
      "description": "Response from POST /api/ticks/:id/close",
      "allOf": [
        { "$ref": "../tick.schema.json" },
        {
          "type": "object",
          "required": ["isBlocked", "column"],
          "properties": {
            "isBlocked": {
              "type": "boolean",
              "description": "Whether this tick is blocked"
            },
            "column": {
              "$ref": "#/$defs/TickColumn",
              "description": "Computed kanban column"
            }
          }
        }
      ]
    },
    "AddNoteResponse": {
      "type": "object",
      "description": "Response from POST /api/ticks/:id/note",
      "allOf": [
        { "$ref": "../tick.schema.json" },
        {
          "type": "object",
          "required": ["isBlocked", "column", "notesList"],
          "properties": {
            "isBlocked": {
              "type": "boolean",
              "description": "Whether this tick is blocked"
            },
            "column": {
              "$ref": "#/$defs/TickColumn",
              "description": "Computed kanban column"
            },
            "notesList": {
              "type": "array",
              "items": { "$ref": "#/$defs/Note" },
              "description": "Updated parsed notes"
            }
          }
        }
      ]
    },
    "InfoResponse": {
      "type": "object",
      "description": "Response from GET /api/info",
      "required": ["repoName", "epics"],
      "properties": {
        "repoName": {
          "type": "string",
          "description": "Full repository name (owner/repo[:worktree])"
        },
        "epics": {
          "type": "array",
          "items": { "$ref": "#/$defs/EpicInfo" },
          "description": "List of epics for dropdown"
        }
      }
    },
    "ActivityResponse": {
      "type": "object",
      "description": "Response from GET /api/activity",
      "required": ["activities"],
      "properties": {
        "activities": {
          "type": "array",
          "items": { "$ref": "../activity.schema.json" },
          "description": "List of activity entries"
        }
      }
    },
    "ActiveToolRecord": {
      "type": "object",
      "description": "Active tool during a live run",
      "required": ["name"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Tool name"
        },
        "input": {
          "type": "string",
          "description": "Tool input (may be partial)"
        },
        "output": {
          "type": "string",
          "description": "Tool output (may be partial)"
        },
        "duration_ms": {
          "type": "integer",
          "minimum": 0,
          "description": "Duration so far in milliseconds"
        },
        "is_error": {
          "type": "boolean",
          "description": "Whether the tool has errored"
        }
      }
    },
    "ActiveTaskStatus": {
      "type": "object",
      "description": "Status of the currently executing task",
      "required": ["tickId", "title", "status", "numTurns", "metrics", "lastUpdated"],
      "properties": {
        "tickId": {
          "type": "string",
          "description": "ID of the task being executed"
        },
        "title": {
          "type": "string",
          "description": "Task title"
        },
        "status": {
          "type": "string",
          "description": "Current execution status"
        },
        "activeTool": {
          "$ref": "#/$defs/ActiveToolRecord",
          "description": "Currently executing tool (if any)"
        },
        "numTurns": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of API turns so far"
        },
        "metrics": {
          "$ref": "../run.schema.json#/$defs/MetricsRecord",
          "description": "Current metrics"
        },
        "lastUpdated": {
          "type": "string",
          "format": "date-time",
          "description": "ISO timestamp of last update"
        }
      }
    },
    "LiveRecord": {
      "type": "object",
      "description": "Live run record for in-progress execution",
      "required": ["session_id", "model", "started_at", "output", "metrics", "num_turns", "status", "last_updated"],
      "properties": {
        "session_id": {
          "type": "string",
          "description": "Session identifier"
        },
        "model": {
          "type": "string",
          "description": "Model being used"
        },
        "started_at": {
          "type": "string",
          "format": "date-time",
          "description": "When the run started"
        },
        "output": {
          "type": "string",
          "description": "Output so far"
        },
        "thinking": {
          "type": "string",
          "description": "Thinking content so far"
        },
        "tools": {
          "type": "array",
          "items": { "$ref": "../run.schema.json#/$defs/ToolRecord" },
          "description": "Completed tool invocations"
        },
        "metrics": {
          "$ref": "../run.schema.json#/$defs/MetricsRecord",
          "description": "Current metrics"
        },
        "num_turns": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of turns so far"
        },
        "status": {
          "type": "string",
          "description": "Current status"
        },
        "active_tool": {
          "$ref": "#/$defs/ActiveToolRecord",
          "description": "Currently executing tool"
        },
        "last_updated": {
          "type": "string",
          "format": "date-time",
          "description": "Last update timestamp"
        }
      }
    },
    "RunStatusResponse": {
      "type": "object",
      "description": "Response from GET /api/run-status/:epicId",
      "required": ["epicId", "isRunning"],
      "properties": {
        "epicId": {
          "type": "string",
          "description": "Epic being queried"
        },
        "isRunning": {
          "type": "boolean",
          "description": "Whether there is an active run for this epic"
        },
        "activeTask": {
          "$ref": "#/$defs/ActiveTaskStatus",
          "description": "Status of currently executing task"
        },
        "metrics": {
          "$ref": "#/$defs/LiveRecord",
          "description": "Live run metrics"
        }
      }
    }
  }
}
