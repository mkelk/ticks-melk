{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://ticks.sh/schemas/run.schema.json",
  "title": "Run Records",
  "description": "Types for agent run execution records",
  "$defs": {
    "MetricsRecord": {
      "type": "object",
      "description": "Token and cost metrics for an agent run",
      "required": [
        "input_tokens",
        "output_tokens",
        "cache_read_tokens",
        "cache_creation_tokens",
        "cost_usd",
        "duration_ms"
      ],
      "properties": {
        "input_tokens": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of input tokens consumed"
        },
        "output_tokens": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of output tokens generated"
        },
        "cache_read_tokens": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of tokens read from cache"
        },
        "cache_creation_tokens": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of tokens written to cache"
        },
        "cost_usd": {
          "type": "number",
          "minimum": 0,
          "description": "Total cost in USD"
        },
        "duration_ms": {
          "type": "integer",
          "minimum": 0,
          "description": "Total duration in milliseconds"
        }
      }
    },
    "ToolRecord": {
      "type": "object",
      "description": "Record of a single tool invocation",
      "required": ["name", "duration_ms"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of the tool that was invoked"
        },
        "input": {
          "type": "string",
          "description": "Tool input (may be truncated)"
        },
        "output": {
          "type": "string",
          "description": "Tool output (may be truncated)"
        },
        "duration_ms": {
          "type": "integer",
          "minimum": 0,
          "description": "Tool execution duration in milliseconds"
        },
        "is_error": {
          "type": "boolean",
          "description": "Whether the tool invocation resulted in an error"
        }
      }
    },
    "VerifierResult": {
      "type": "object",
      "description": "Result from a single verifier",
      "required": ["verifier", "passed", "duration_ms"],
      "properties": {
        "verifier": {
          "type": "string",
          "description": "Name of the verifier (e.g., git, test)"
        },
        "passed": {
          "type": "boolean",
          "description": "Whether this verifier passed"
        },
        "output": {
          "type": "string",
          "description": "Verifier output (may be truncated)"
        },
        "duration_ms": {
          "type": "integer",
          "minimum": 0,
          "description": "Verifier execution duration in milliseconds"
        },
        "error": {
          "type": "string",
          "description": "Error message if verification failed due to an error"
        }
      }
    },
    "VerificationRecord": {
      "type": "object",
      "description": "Aggregated verification results for a run",
      "required": ["all_passed"],
      "properties": {
        "all_passed": {
          "type": "boolean",
          "description": "Whether all verifiers passed"
        },
        "results": {
          "type": "array",
          "items": { "$ref": "#/$defs/VerifierResult" },
          "description": "Individual verifier results"
        }
      }
    },
    "RunRecord": {
      "type": "object",
      "description": "Complete record of a finished agent run",
      "required": [
        "session_id",
        "model",
        "started_at",
        "ended_at",
        "output",
        "metrics",
        "success",
        "num_turns"
      ],
      "properties": {
        "session_id": {
          "type": "string",
          "description": "Unique session identifier"
        },
        "model": {
          "type": "string",
          "description": "Model used for the run (e.g., claude-sonnet-4-20250514)"
        },
        "started_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO timestamp when the run started"
        },
        "ended_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO timestamp when the run ended"
        },
        "output": {
          "type": "string",
          "description": "Final output text from the agent"
        },
        "thinking": {
          "type": "string",
          "description": "Thinking/reasoning content (if extended thinking was used)"
        },
        "tools": {
          "type": "array",
          "items": { "$ref": "#/$defs/ToolRecord" },
          "description": "List of tool invocations during the run"
        },
        "metrics": {
          "$ref": "#/$defs/MetricsRecord",
          "description": "Token and cost metrics"
        },
        "success": {
          "type": "boolean",
          "description": "Whether the run completed successfully"
        },
        "num_turns": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of API round-trips"
        },
        "error_msg": {
          "type": "string",
          "description": "Error message if the run failed"
        },
        "verification": {
          "$ref": "#/$defs/VerificationRecord",
          "description": "Verification results (if verification was run)"
        }
      }
    },
    "RunStatus": {
      "type": "string",
      "enum": ["starting", "thinking", "writing", "tool_use", "complete", "error"],
      "description": "Current state of an in-progress agent run"
    }
  }
}
