{
  "id": "ws1",
  "title": "Unified UI build process for local and cloud deployment",
  "description": "Create a single build process that outputs UI for both local (tk binary) and cloud (CF Pages).\n\n## Current State\n\n- UI source: internal/tickboard/ui/\n- Local serving: tk board serves from disk (dev) or embedded (release)\n- Cloud: Not yet deployed to Pages\n\n## Build Outputs\n\n```\ninternal/tickboard/ui/\n├── src/                    # Source\n├── dist/                   # Built output (gitignored)\n└── embedded/               # Copied to embedded/ for go:embed\n    └── dist/\n        ├── index.html\n        ├── assets/\n        └── ...\n```\n\n## Build Script\n\n```bash\n#!/bin/bash\n# scripts/build-ui.sh\n\nset -e\n\ncd internal/tickboard/ui\n\n# Install deps if needed\nif [ ! -d node_modules ]; then\n    npm ci\nfi\n\n# Build\nnpm run build\n\n# Copy to embedded directory for go:embed\nrm -rf ../embedded/dist\ncp -r dist ../embedded/\n\necho \"UI built successfully\"\necho \"  - dist/ for CF Pages deployment\"\necho \"  - ../embedded/dist/ for go:embed\"\n```\n\n## Go Embedding\n\n```go\n// internal/tickboard/server/embedded.go\npackage server\n\nimport \"embed\"\n\n//go:embed embedded/dist/*\nvar embeddedUI embed.FS\n\nfunc (s *Server) serveUI(w http.ResponseWriter, r *http.Request) {\n    // Serve from embedded FS in release mode\n    // Serve from disk in dev mode (for hot reload)\n    if s.devMode {\n        http.FileServer(http.Dir(\"internal/tickboard/ui/dist\")).ServeHTTP(w, r)\n    } else {\n        http.FileServer(http.FS(embeddedUI)).ServeHTTP(w, r)\n    }\n}\n```\n\n## Makefile Integration\n\n```makefile\n# Makefile\n\n.PHONY: build build-ui\n\nbuild-ui:\n\t@./scripts/build-ui.sh\n\nbuild: build-ui\n\tgo build -o tk ./cmd/tk\n\nrelease: build-ui\n\t# Build for all platforms\n\tGOOS=darwin GOARCH=amd64 go build -o dist/tk-darwin-amd64 ./cmd/tk\n\tGOOS=darwin GOARCH=arm64 go build -o dist/tk-darwin-arm64 ./cmd/tk\n\tGOOS=linux GOARCH=amd64 go build -o dist/tk-linux-amd64 ./cmd/tk\n```\n\n## GitHub Actions\n\n```yaml\n# .github/workflows/release.yml\njobs:\n  release:\n    steps:\n      - uses: actions/checkout@v4\n      \n      - uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n      \n      - uses: actions/setup-go@v5\n        with:\n          go-version: '1.22'\n      \n      # Build UI once\n      - name: Build UI\n        run: ./scripts/build-ui.sh\n      \n      # Build Go binaries (includes embedded UI)\n      - name: Build binaries\n        run: make release\n      \n      # Deploy to CF Pages (same dist/)\n      - name: Deploy to Pages\n        uses: cloudflare/pages-action@v1\n        with:\n          directory: internal/tickboard/ui/dist\n          projectName: tickboard\n```\n\n## Dev Workflow\n\n```bash\n# Dev mode - UI served from disk, supports hot reload\ncd internal/tickboard/ui \u0026\u0026 npm run dev \u0026\ntk run --board --dev  # serves from disk, not embedded\n\n# Production build\nmake build  # builds UI, embeds in binary\n./tk run --board  # serves from embedded\n```\n\n## Version Sync\n\nEmbed version in UI build:\n```typescript\n// vite.config.ts\ndefine: {\n  '__APP_VERSION__': JSON.stringify(process.env.VERSION || 'dev'),\n}\n```\n\n```bash\n# In build script\nVERSION=$(git describe --tags) npm run build\n```\n\nUI shows version in footer, helps debug version mismatches.",
  "status": "closed",
  "priority": 1,
  "type": "task",
  "owner": "peter@engelbrecht.dk",
  "parent": "y1i",
  "created_by": "peter@engelbrecht.dk",
  "created_at": "2026-01-21T16:55:10.652153Z",
  "updated_at": "2026-01-21T18:40:03.927437Z",
  "closed_at": "2026-01-21T18:40:03.927437Z",
  "closed_reason": "Created unified UI build process. Added scripts/build-ui.sh that builds UI via vite, outputs to server/static/ (for go:embed) and ui/dist/ (for CF Pages). Added --dev flag to tk run for hot reload from disk. Added ServerOption pattern to server.New() for configuration."
}